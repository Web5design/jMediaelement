(function(e){var t='<button class="{%class%}"><span class="jme-icon"></span><span class="jme-text">{%text%}</span></button>',n="pseudoClasses";e.jme.fullscreen=function(){var t,n,i=document.documentElement,r={supportsFullScreen:Modernizr.prefixed("fullscreenEnabled",document,!1)||Modernizr.prefixed("fullScreenEnabled",document,!1),isFullScreen:function(){return!1},requestFullScreen:function(i){var r;t=[],e(i).parentsUntil("body").each(function(){var n,i=e.css(this,"position"),a=this.scrollLeft,s=this.scrollTop;r={elemStyle:this.style,elem:this},"static"!==i&&(n=!0,r.pos=r.elemStyle.position,this.style.position="static"),a&&(n=!0,r.left=a),s&&(n=!0,r.top=s),n&&t.push(r)}),n=!1;try{n={elemStyle:frameElement.style,elem:frameElement,css:{}},n.css.position=n.elemStyle.position,n.elemStyle.position="fixed",e.each(["top","left","right","bottom"],function(e,t){n.css[t]=n.elemStyle[t],n.elemStyle[t]="0px"}),e.each(["height","width"],function(e,t){n.css[t]=n.elemStyle[t],n.elemStyle[t]="100%"})}catch(a){n=!1}r=null},cancelFullScreen:function(){t&&(e.each(t,function(e,t){"pos"in t&&(t.elemStyle.position=t.pos),t.left&&(t.elem.scrollLeft=t.left),t.top&&(t.elem.scrollTop=t.top),t=null}),t=[]),n&&(e.each(n.css,function(e,t){n.elemStyle[e]=t}),n=!1)},eventName:"fullscreenchange",exitName:"exitFullscreen",requestName:"requestFullscreen",elementName:"fullscreenElement",enabledName:""};return r.cancelFullWindow=r.cancelFullScreen,r.requestFullWindow=r.requestFullScreen,r.supportsFullScreen&&(r.enabledName=r.supportsFullScreen,r.exitName=Modernizr.prefixed("exitFullscreen",document,!1)||Modernizr.prefixed("cancelFullScreen",document,!1),r.elementName=Modernizr.prefixed("fullscreenElement",document,!1)||Modernizr.prefixed("fullScreenElement",document,!1),r.supportsFullScreen=!!r.supportsFullScreen,("fullscreenElement"!=r.elementName||"exitFullscreen"!=r.exitName||"fullscreenEnabled"!=r.enabledName)&&e.each(Modernizr._domPrefixes,function(e,t){var n=t+"RequestFullscreen";return n in i||(n=t+"RequestFullScreen")&&n in i?(r.eventName=t+"fullscreenchange",r.requestName=n,!1):void 0}),r.isFullScreen=function(){return document[r.elementName]},r.requestFullScreen=function(e){return e[r.requestName]()},r.cancelFullScreen=function(){return document[r.exitName]()}),window.Modernizr&&"fullscreen"in Modernizr||e("html").addClass(r.supportsFullScreen?"fullscreen":"no-fullscreen"),window.parent!=window&&function(){try{var t=window.frameElement;t.style,r.supportsFullScreen&&("allowfullscreen"in t&&!t.allowfullscreen?t.allowfullscreen=!0:(null==t.getAttribute("webkitallowfullscreen")&&t.setAttribute("webkitallowfullscreen",""),null==t.getAttribute("allowfullscreen")&&t.setAttribute("allowfullscreen","allowfullscreen")))}catch(n){r.supportsFullScreen||e("html").addClass("no-fullwindow")}}(),r}(),e.jme.defineProp("fullscreen",{set:function(t,n){var i=e.jme.data(t);if(!i||!i.player)return"noDataSet";if(n){if(i.player.hasClass(e.jme.classNS+"player-fullscreen"))return"noDataSet";if(i.scrollPos={top:e(window).scrollTop(),left:e(window).scrollLeft()},e(document).unbind(".jmefullscreen").bind("keydown.jmefullscreen",function(e){return 27==e.keyCode?(i.player.jmeProp("fullscreen",!1),!1):32!==e.keyCode||"form"in e.target?void 0:(i.media.jmeFn("togglePlay"),!1)}),"fullwindow"==n)e.jme.fullscreen.requestFullWindow(i.player[0]);else try{e.jme.fullscreen.requestFullScreen(i.player[0])}catch(r){}e("html").addClass(e.jme.classNS+"has-media-fullscreen"),i.player.addClass(e.jme.classNS+"player-fullscreen"),i.media.addClass(e.jme.classNS+"media-fullscreen"),e(".jme-default-control-bar",i.player).focus(),e.jme.fullscreen.supportsFullScreen&&e(document).bind(e.jme.fullscreen.eventName+".jmefullscreen",function(){var n=e.jme.fullscreen.isFullScreen();n&&t==n?e(t).triggerHandler("playerdimensionchange",["fullscreen"]):i.player.jmeProp("fullscreen",!1)}),i.player.triggerHandler("playerdimensionchange",["fullwindow"])}else{if(!i.player.hasClass(e.jme.classNS+"player-fullscreen"))return"noDataSet";if(e(document).unbind(".jmefullscreen"),e("html").removeClass(e.jme.classNS+"has-media-fullscreen"),i.player.removeClass(e.jme.classNS+"player-fullscreen"),i.media.removeClass(e.jme.classNS+"media-fullscreen"),e.jme.fullscreen.isFullScreen())try{e.jme.fullscreen.cancelFullScreen()}catch(r){}else e.jme.fullscreen.cancelFullWindow();i.player.triggerHandler("playerdimensionchange"),i.scrollPos&&(e(window).scrollTop(i.scrollPos.top),e(window).scrollLeft(i.scrollPos.left),delete i.scrollPos)}return"noDataSet"},get:function(t){var n=e.jme.data(t);if(n&&n.player){var i=n.player.hasClass(e.jme.classNS+"player-fullscreen");return i?e.jme.fullscreen.isFullScreen()||"fullwindow":!1}}}),e.jme.defineProp("autoplayfs"),e.jme.registerPlugin("fullscreen",{pseudoClasses:{enter:"state-enterfullscreen",exit:"state-exitfullscreen"},options:{fullscreen:!0,autoplayfs:!1},structure:t,text:"enter fullscreen / exit fullscreen",_create:function(t,i,r){var a=e.jme.getButtonText(t,[this[n].enter,this[n].exit]),s=function(){a(r.hasClass(e.jme.classNS+"player-fullscreen")?1:0)},o=this.options,l=function(){e(r.data("jme").controlElements).filter(".jme-default-media-overlay").off(".dblfullscreen").on("dblclick.dblfullscreen",function(){r.jmeProp("fullscreen",!r.jmeProp("fullscreen"))})};r.on("controlsadded",l),r.bind("playerdimensionchange",s),t.bind(t.is("select")?"change":"click",function(){var t=r.hasClass(e.jme.classNS+"player-fullscreen")?!1:o.fullscreen;r.jmeProp("fullscreen",t),t&&o.autoplayfs&&i.jmeFn("play")}),l(),s()}})})(jQuery);